<!DOCTYPE html>
<html lang="ro">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Asistent Trading — Cloud-assisted RAG</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto; }
    </style>
  </head>
  <body class="min-h-screen antialiased bg-gray-50 text-gray-900">
    <!-- Background -->
    <div class="fixed inset-0 -z-10">
      <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1542142460-5de862c36a6d?q=80&w=2069&auto=format&fit=crop')] bg-cover bg-center"></div>
      <div class="absolute inset-0 bg-white/60"></div>
    </div>

    <!-- Help/Dex Sticky Button -->
    <button id="helpDexBtn" class="fixed left-4 bottom-4 z-50 inline-flex items-center gap-2 px-3 py-2 rounded-full shadow-lg bg-gray-900 text-white hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-900/20">
      <i data-lucide="info" class="w-4 h-4"></i>
      <span class="text-sm font-medium">Ajutor / Dex</span>
    </button>

    <!-- Help/Dex Modal -->
    <div id="helpDexModal" class="hidden fixed inset-0 z-50">
      <div class="absolute inset-0 bg-black/40"></div>
      <div class="relative mx-auto my-8 w-[95%] max-w-3xl bg-white rounded-2xl border border-gray-200 overflow-hidden">
        <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200">
          <div class="flex items-center gap-2">
            <i data-lucide="book-open-text" class="w-5 h-5 text-gray-700"></i>
            <h2 class="text-lg tracking-tight font-semibold">Ghid rapid / Dex</h2>
          </div>
          <button data-close-help class="p-2 rounded-lg border bg-gray-50 hover:bg-gray-100" aria-label="Închide">
            <i data-lucide="x" class="w-4 h-4"></i>
          </button>
        </div>
        <div class="p-4 space-y-4 max-h-[70vh] overflow-auto text-sm">
          <div class="rounded-lg border bg-gray-50/70 p-3">
            <div class="font-semibold mb-1">Strategii</div>
            <ul class="list-disc pl-5 space-y-1">
              <li><span class="font-medium">EQ-INV</span>: investiții pe termen lung (acțiuni/ETF), focus pe quality și rebalansare.</li>
              <li><span class="font-medium">EQ-MOM/PEAD</span>: momentum și catalizatori de earnings (gap, volum, follow-through).</li>
              <li><span class="font-medium">OPT-INCOME</span>: venit din opțiuni (covered calls, cash‑secured puts) cu risc controlat.</li>
            </ul>
          </div>
          <div class="rounded-lg border bg-gray-50/70 p-3">
            <div class="font-semibold mb-1">Parametri retrieval</div>
            <ul class="list-disc pl-5 space-y-1">
              <li><span class="font-medium">K</span>: câte pasaje se caută în prima etapă (ex. 16–24).</li>
              <li><span class="font-medium">N</span>: câte pasaje rămân după reranker (ex. 3–5).</li>
              <li><span class="font-medium">τ</span>: prag minim de relevanță (0–1). Sub prag → nu afișăm pasajul.</li>
              <li><span class="font-medium">Reranker</span>: reordonare mai bună a pasajelor relevante.</li>
              <li><span class="font-medium">MMR</span>: diversitate în top‑N (evită duplicatele).</li>
            </ul>
          </div>
          <div class="rounded-lg border bg-gray-50/70 p-3">
            <div class="font-semibold mb-1">Termeni macro (exemple)</div>
            <ul class="list-disc pl-5 space-y-1">
              <li><span class="font-medium">CPI</span>: inflația de consum; sub așteptări → presiune mai mică pe dobânzi.</li>
              <li><span class="font-medium">NFP</span>: joburi non‑agricole; stabil → piață muncii robustă.</li>
              <li><span class="font-medium">Real yields</span>: randamente reale; în scădere → suport pentru active de risc.</li>
            </ul>
          </div>
          <div class="rounded-lg border bg-gray-50/70 p-3">
            <div class="font-semibold mb-1">Decizii LLM în răspuns</div>
            <ul class="list-disc pl-5 space-y-1">
              <li><span class="font-medium">Teză</span>: mesaj concis susținut de citări [n].</li>
              <li><span class="font-medium">Setup</span>: condiții necesare pentru idee (tehnic/fundamental).</li>
              <li><span class="font-medium">Invalidare</span>: când renunțăm la idee (nivel/pattern).</li>
              <li><span class="font-medium">Niveluri</span>: entry/stop/TP prezentate clar.</li>
              <li><span class="font-medium">Risc/Incertitudine</span>: evaluare simplă (low/med/high).</li>
            </ul>
          </div>
        </div>
        <div class="px-4 py-3 border-t border-gray-200 text-xs text-gray-500 flex items-center justify-between">
          <span>Glisează pentru a vedea tot conținutul. Închide cu X.</span>
          <button data-close-help class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-900 text-white text-sm hover:bg-gray-800">
            <i data-lucide="check" class="w-4 h-4"></i> Închis
          </button>
        </div>
      </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-6">
      <!-- Header -->
      <nav class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 rounded-xl bg-gray-900 text-white flex items-center justify-center shadow-md">
            <i data-lucide="activity" class="w-4 h-4"></i>
          </div>
          <span class="text-lg tracking-tight font-semibold">Asistent Trading</span>
          <span class="hidden sm:inline text-gray-500 text-sm font-medium">Cloud‑assisted RAG</span>
        </div>

        <div class="hidden md:flex items-center gap-2">
          <button id="btnBrief" class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-white/70 backdrop-blur border border-gray-200 hover:bg-white transition focus:outline-none focus:ring-2 focus:ring-gray-900/10" aria-label="Daily Brief">
            <i data-lucide="sunrise" class="w-4 h-4"></i>
            <span class="text-sm font-medium">Daily Brief</span>
          </button>
          <button id="btnGuide" class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-white/70 backdrop-blur border border-gray-200 hover:bg-white transition focus:outline-none focus:ring-2 focus:ring-gray-900/10" aria-label="Ghid începător">
            <i data-lucide="book-open" class="w-4 h-4"></i>
            <span class="text-sm font-medium">Ghid începător</span>
          </button>
          <button id="btnJournal" class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-white/70 backdrop-blur border border-gray-200 hover:bg-white transition focus:outline-none focus:ring-2 focus:ring-gray-900/10" aria-label="Jurnal">
            <i data-lucide="notebook-pen" class="w-4 h-4"></i>
            <span class="text-sm font-medium">Jurnal</span>
          </button>
          <button id="btnUpload" class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-white/70 backdrop-blur border border-gray-200 hover:bg-white transition focus:outline-none focus:ring-2 focus:ring-gray-900/10" aria-label="Upload">
            <i data-lucide="upload-cloud" class="w-4 h-4"></i>
            <span class="text-sm font-medium">Upload</span>
          </button>
          <button id="btnSettings" class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-900 hover:bg-gray-800 transition focus:outline-none focus:ring-2 focus:ring-gray-900/20" aria-label="Setări">
            <i data-lucide="settings" class="w-4 h-4"></i>
            <span class="text-sm font-medium">Setări</span>
          </button>
          <div class="ml-2 inline-flex items-center gap-2 px-2 py-1 rounded-lg bg-white/70 backdrop-blur border border-gray-200 text-xs">
            <span class="text-gray-600">Mock mode</span>
            <label class="inline-flex items-center cursor-pointer" aria-label="Comută Mock Mode">
              <input id="toggleMock" type="checkbox" class="sr-only" checked>
              <span class="w-10 h-6 rounded-full bg-gray-200 relative">
                <span id="toggleMockKnob" class="absolute top-0.5 left-0.5 w-5 h-5 rounded-full bg-gray-900 transition-all"></span>
              </span>
              <span id="toggleMockLabel" class="ml-2 text-gray-700">ON</span>
            </label>
          </div>
        </div>

        <div class="md:hidden">
          <button id="btnMenu" class="inline-flex items-center justify-center p-2 rounded-lg bg-white/70 backdrop-blur border border-gray-200 hover:bg-white transition focus:outline-none focus:ring-2 focus:ring-gray-900/10" aria-label="Menu">
            <i data-lucide="menu" class="w-5 h-5"></i>
          </button>
        </div>
      </nav>

      <!-- Mobile Actions -->
      <div id="mobileActions" class="md:hidden mt-3 hidden">
        <div class="flex flex-wrap items-center gap-2">
          <button id="mBtnBrief" class="flex-1 inline-flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-white/70 backdrop-blur border border-gray-200 hover:bg-white transition focus:outline-none focus:ring-2 focus:ring-gray-900/10">
            <i data-lucide="sunrise" class="w-4 h-4"></i>
            <span class="text-sm font-medium">Daily Brief</span>
          </button>
          <button id="mBtnJournal" class="flex-1 inline-flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-white/70 backdrop-blur border border-gray-200 hover:bg-white transition focus:outline-none focus:ring-2 focus:ring-gray-900/10">
            <i data-lucide="notebook-pen" class="w-4 h-4"></i>
            <span class="text-sm font-medium">Jurnal</span>
          </button>
          <button id="mBtnUpload" class="flex-1 inline-flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-white/70 backdrop-blur border border-gray-200 hover:bg-white transition focus:outline-none focus:ring-2 focus:ring-gray-900/10">
            <i data-lucide="upload-cloud" class="w-4 h-4"></i>
            <span class="text-sm font-medium">Upload</span>
          </button>
          <button id="mBtnSettings" class="flex-1 inline-flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-gray-900 text-white border border-gray-900 hover:bg-gray-800 transition focus:outline-none focus:ring-2 focus:ring-gray-900/20">
            <i data-lucide="settings" class="w-4 h-4"></i>
            <span class="text-sm font-medium">Setări</span>
          </button>
        </div>
        <div class="mt-2 inline-flex items-center gap-2 px-2 py-1 rounded-lg bg-white/70 backdrop-blur border border-gray-200 text-xs">
          <span class="text-gray-600">Mock mode</span>
          <label class="inline-flex items-center cursor-pointer" aria-label="Comută Mock Mode">
            <input id="mToggleMock" type="checkbox" class="sr-only" checked>
            <span class="w-10 h-6 rounded-full bg-gray-200 relative">
              <span id="mToggleMockKnob" class="absolute top-0.5 left-0.5 w-5 h-5 rounded-full bg-gray-900 transition-all"></span>
            </span>
            <span id="mToggleMockLabel" class="ml-2 text-gray-700">ON</span>
          </label>
        </div>
      </div>

      <!-- Policy + Risk badges -->
      <div class="mt-4 flex flex-wrap items-center gap-2">
        <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/70 backdrop-blur border border-gray-200">
          <div class="w-1.5 h-1.5 rounded-full bg-emerald-500"></div>
          <span class="text-xs font-medium">Răspuns generat strict din pasaje citate (Context-Only).</span>
        </div>
        <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-amber-50 border border-amber-200 text-amber-800">
          <i data-lucide="alert-triangle" class="w-4 h-4"></i>
          <span class="text-xs font-medium">Sugestii, nu ordine. Respectă limitele de risc setate.</span>
        </div>
      </div>

      <!-- Strategy Tabs + Query -->
      <div class="mt-6 bg-white/70 backdrop-blur border border-gray-200 rounded-2xl p-2">
        <div class="flex items-center justify-between">
          <div class="flex gap-1" role="tablist" aria-label="Strategii">
            <button data-tab="EQ_INV" class="tab-btn px-4 py-2 rounded-xl text-sm font-medium hover:bg-white focus:outline-none focus:ring-2 focus:ring-gray-900/10" aria-selected="true">EQ-INV</button>
            <button data-tab="EQ_MOM_PEAD" class="tab-btn px-4 py-2 rounded-xl text-sm font-medium hover:bg-white focus:outline-none focus:ring-2 focus:ring-gray-900/10" aria-selected="false">EQ-MOM/PEAD</button>
            <button data-tab="OPT_INCOME" class="tab-btn px-4 py-2 rounded-xl text-sm font-medium hover:bg-white focus:outline-none focus:ring-2 focus:ring-gray-900/10" aria-selected="false">OPT-INCOME</button>
          </div>
          <div class="hidden sm:flex items-center gap-2 text-xs text-gray-500 pr-1">
            <span class="inline-flex items-center gap-1 px-2 py-1 rounded-lg bg-white border border-gray-200"><i data-lucide="filter" class="w-3.5 h-3.5"></i><span id="chipK">K=—</span></span>
            <span class="inline-flex items-center gap-1 px-2 py-1 rounded-lg bg-white border border-gray-200"><i data-lucide="list-filter" class="w-3.5 h-3.5"></i><span id="chipN">N=—</span></span>
            <span class="inline-flex items-center gap-1 px-2 py-1 rounded-lg bg-white border border-gray-200"><i data-lucide="sigma" class="w-3.5 h-3.5"></i><span id="chipTau">τ=—</span></span>
            <span class="inline-flex items-center gap-1 px-2 py-1 rounded-lg bg-white border border-gray-200"><i data-lucide="scan-line" class="w-3.5 h-3.5"></i><span id="chipReranker">Reranker ON</span></span>
            <span class="inline-flex items-center gap-1 px-2 py-1 rounded-lg bg-white border border-gray-200"><i data-lucide="shuffle" class="w-3.5 h-3.5"></i><span id="chipMMR">MMR ON</span></span>
            <span class="inline-flex items-center gap-1 px-2 py-1 rounded-lg bg-white border border-gray-200"><i data-lucide="newspaper" class="w-3.5 h-3.5"></i><span id="chipRecency">Recency: News</span></span>
          </div>
        </div>

        <!-- Query Row -->
        <div class="mt-3 bg-white border border-gray-200 rounded-xl p-2.5">
          <form id="qaForm" class="flex items-center gap-2" aria-label="Întrebare strategie">
            <div class="flex-1 relative">
              <input id="questionInput" type="text" placeholder="Adresează întrebarea ta pentru strategia activă..." class="w-full rounded-lg border border-gray-200 px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-gray-900/10 focus:border-gray-300 placeholder:text-gray-400" aria-label="Întrebare">
              <div class="absolute right-2.5 top-2.5 text-gray-400">
                <i data-lucide="message-square" class="w-4 h-4"></i>
              </div>
            </div>
            <button id="btnAsk" type="submit" class="inline-flex items-center gap-2 rounded-lg bg-gray-900 text-white px-4 py-2.5 text-sm font-medium hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-900/20">
              <i data-lucide="sparkles" class="w-4 h-4"></i>
              Răspunde
            </button>
          </form>
        </div>

        <!-- States & Answer -->
        <div id="answerRegion" class="mt-4">
          <!-- Skeleton -->
          <div id="answerSkeleton" class="hidden bg-white border border-gray-200 rounded-2xl p-4">
            <div class="animate-pulse">
              <div class="h-4 bg-gray-100 rounded w-24 mb-2"></div>
              <div class="h-5 bg-gray-100 rounded w-3/4 mb-1.5"></div>
              <div class="h-5 bg-gray-100 rounded w-2/3 mb-4"></div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <div class="h-24 bg-gray-100 rounded"></div>
                <div class="h-24 bg-gray-100 rounded"></div>
                <div class="h-24 bg-gray-100 rounded"></div>
              </div>
              <div class="h-4 bg-gray-100 rounded w-40 mt-4"></div>
            </div>
          </div>

          <!-- Error -->
          <div id="answerError" class="hidden bg-rose-50 text-rose-800 border border-rose-200 rounded-xl p-3 text-sm">
            <div class="flex items-center gap-2">
              <i data-lucide="circle-alert" class="w-4 h-4"></i>
              <span>Eroare de rețea. Reîncearcă.</span>
              <button id="retryAsk" class="ml-auto inline-flex items-center gap-1 px-2 py-1 rounded-md bg-rose-100 hover:bg-rose-200 text-rose-900 text-xs">
                <i data-lucide="rotate-cw" class="w-3.5 h-3.5"></i> Reîncearcă
              </button>
            </div>
          </div>

          <!-- Insufficient context -->
          <div id="answerInsufficient" class="hidden bg-amber-50 text-amber-900 border border-amber-200 rounded-xl p-3 text-sm">
            <div class="flex items-center gap-2">
              <i data-lucide="info" class="w-4 h-4"></i>
              <span>Nu am context suficient peste pragul de relevanță. Încarcă surse sau relaxează filtrele.</span>
            </div>
          </div>

          <!-- Answer Card -->
          <div id="answerCard" class="hidden bg-white border border-gray-200 rounded-2xl overflow-hidden">
            <div class="p-4 border-b border-gray-200 flex items-center justify-between">
              <div class="flex items-center gap-2">
                <div class="w-7 h-7 rounded-lg bg-gray-900 text-white flex items-center justify-center">
                  <i data-lucide="brain-circuit" class="w-3.5 h-3.5"></i>
                </div>
                <h3 class="text-base tracking-tight font-semibold">Răspuns Strategie</h3>
                <span id="answerStrategy" class="ml-2 text-xs px-2 py-0.5 rounded-md border bg-gray-50 text-gray-700">—</span>
                <span class="ml-2 inline-flex items-center gap-1 text-xs text-gray-500"><i data-lucide="check-circle" class="w-3.5 h-3.5"></i> Citări obligatorii</span>
              </div>
              <div class="flex items-center gap-2">
                <span id="riskBadge" class="text-xs px-2 py-1 rounded-md border bg-gray-50 text-gray-700">Risc: —</span>
                <span id="uncertaintyBadge" class="text-xs px-2 py-1 rounded-md border bg-gray-50 text-gray-700">Incertitudine: —</span>
              </div>
            </div>

            <div class="p-4 space-y-4">
              <div>
                <div id="labelThesis" class="text-xs text-gray-500 mb-1">Teză</div>
                <p id="thesis" class="text-sm leading-relaxed"></p>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <div class="rounded-xl border border-gray-200 p-3 bg-gray-50/50">
                  <div id="labelSetup" class="text-xs text-gray-500 mb-1">Setup</div>
                  <p id="setup" class="text-sm"></p>
                </div>
                <div class="rounded-xl border border-gray-200 p-3 bg-gray-50/50">
                  <div id="labelInvalidation" class="text-xs text-gray-500 mb-1">Invalidare</div>
                  <p id="invalidation" class="text-sm"></p>
                </div>
                <div class="rounded-xl border border-gray-200 p-3 bg-gray-50/50">
                  <div id="labelLevels" class="text-xs text-gray-500 mb-1">Niveluri</div>
                  <div id="levels" class="text-sm"></div>
                </div>
              </div>

              <div class="flex flex-wrap items-center gap-2 pt-1">
                <button id="toJournal" class="inline-flex items-center gap-2 rounded-lg bg-gray-900 text-white px-3 py-2 text-sm font-medium hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-900/20">
                  <i data-lucide="send" class="w-4 h-4"></i>
                  Trimite în Jurnal
                </button>
              </div>

              <div class="pt-2 border-t border-gray-200">
                <div class="text-xs text-gray-500 mb-2">Surse</div>
                <ul id="sourcesList" class="space-y-2"></ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer tiny -->
      <div class="py-8">
        <div class="text-center text-xs text-gray-500 mb-2">Latency țintă: Query &lt; 3s • Daily Brief &lt; 8s • Toate ideile au citări clicabile.</div>
        <div class="max-w-2xl mx-auto text-xs text-gray-600 bg-white/70 backdrop-blur border border-gray-200 rounded-xl px-3 py-2">
          <div class="font-medium text-gray-700 mb-1">Ajutor rapid</div>
          <ul class="list-disc pl-5 space-y-1">
            <li>Alege tabul corect (nu amesteca strategiile).</li>
            <li>Caută răspunsuri cu citări — apasă pe [n] sau „Deschide pasaj”.</li>
            <li>Dacă nu ai context: încarcă surse la Upload sau ajustează K/N/τ.</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Daily Brief Modal -->
    <div id="briefModal" class="hidden fixed inset-0 z-50">
      <div class="absolute inset-0 bg-black/40"></div>
      <div class="relative mx-auto my-8 w-[95%] max-w-5xl bg-white rounded-2xl border border-gray-200 overflow-hidden">
        <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200">
          <div class="flex items-center gap-2">
            <i data-lucide="sunrise" class="w-5 h-5 text-gray-700"></i>
            <h2 class="text-lg tracking-tight font-semibold">Daily Brief (08:00)</h2>
            <span class="text-xs text-gray-500">Regim Macro + Idei + Calendar</span>
          </div>
          <div class="flex items-center gap-2">
            <button id="refreshBrief" class="inline-flex items-center gap-1 text-xs px-2 py-1 rounded-md border bg-gray-50 hover:bg-gray-100">
              <i data-lucide="rotate-cw" class="w-3.5 h-3.5"></i> Actualizează
            </button>
            <button data-close-brief class="p-2 rounded-lg border bg-gray-50 hover:bg-gray-100" aria-label="Închide">
              <i data-lucide="x" class="w-4 h-4"></i>
            </button>
          </div>
        </div>

        <div id="briefBody" class="p-4 grid grid-cols-1 lg:grid-cols-3 gap-4">
          <!-- Macro Panel -->
          <div class="lg:col-span-1 rounded-xl border border-gray-200 bg-gray-50/50 p-3">
            <div class="flex items-center justify-between mb-2">
              <div class="flex items-center gap-2">
                <i data-lucide="globe-2" class="w-4 h-4 text-gray-700"></i>
                <h3 class="text-sm font-semibold tracking-tight">Regim piață (Macro)</h3>
              </div>
              <span id="macroStance" class="text-xs px-2 py-1 rounded-md border bg-white">—</span>
            </div>
            <div id="macroNotes">
              <div class="brief-skel animate-pulse space-y-2">
                <div class="h-4 bg-gray-100 rounded"></div>
                <div class="h-4 bg-gray-100 rounded w-5/6"></div>
                <div class="h-4 bg-gray-100 rounded w-4/6"></div>
              </div>
            </div>
            <div id="macroLegend" class="mt-3 text-xs text-gray-600">
              <div class="font-medium text-gray-700 mb-1">Legendă termeni</div>
              <div class="flex flex-wrap gap-2">
                <span class="inline-flex items-center gap-1 px-2 py-1 rounded-lg border bg-white">CPI <button class="info-inline" data-popover="cpi" aria-label="Detalii: CPI"><i data-lucide="info" class="w-3.5 h-3.5"></i></button></span>
                <span class="inline-flex items-center gap-1 px-2 py-1 rounded-lg border bg-white">NFP <button class="info-inline" data-popover="nfp" aria-label="Detalii: NFP"><i data-lucide="info" class="w-3.5 h-3.5"></i></button></span>
                <span class="inline-flex items-center gap-1 px-2 py-1 rounded-lg border bg-white">Real yields <button class="info-inline" data-popover="realyields" aria-label="Detalii: Real yields"><i data-lucide="info" class="w-3.5 h-3.5"></i></button></span>
              </div>
            </div>
          </div>

          <!-- Ideas Panel -->
          <div class="lg:col-span-2 rounded-xl border border-gray-200 bg-gray-50/50 p-3">
            <div class="flex items-center gap-2 mb-2">
              <i data-lucide="lightbulb" class="w-4 h-4 text-gray-700"></i>
              <h3 class="text-sm font-semibold tracking-tight">Top 3 idei / strategie</h3>
            </div>
            <div id="ideasWrap" class="space-y-3">
              <div class="animate-pulse grid grid-cols-1 md:grid-cols-3 gap-3">
                <div class="h-24 bg-gray-100 rounded"></div>
                <div class="h-24 bg-gray-100 rounded"></div>
                <div class="h-24 bg-gray-100 rounded"></div>
              </div>
            </div>
          </div>

          <!-- Calendar Panel -->
          <div class="lg:col-span-3 rounded-xl border border-gray-200 bg-gray-50/50 p-3">
            <div class="flex items-center gap-2 mb-2">
              <i data-lucide="calendar-days" class="w-4 h-4 text-gray-700"></i>
              <h3 class="text-sm font-semibold tracking-tight">Calendar evenimente (azi)</h3>
            </div>
            <div id="calendarWrap" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
              <div class="animate-pulse h-16 bg-gray-100 rounded"></div>
              <div class="animate-pulse h-16 bg-gray-100 rounded"></div>
              <div class="animate-pulse h-16 bg-gray-100 rounded"></div>
            </div>
          </div>
        </div>

        <div class="px-4 py-3 border-t border-gray-200 flex items-center justify-between">
          <span class="text-xs text-gray-500">Toate notele și ideile includ citări. Click „Deschide pasaj” pentru auditare.</span>
          <button data-close-brief class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-900 text-white text-sm hover:bg-gray-800">
            <i data-lucide="check" class="w-4 h-4"></i> Închis
          </button>
        </div>
      </div>
    </div>
    <!-- Beginner Guide Modal -->
    <div id="guideModal" class="hidden fixed inset-0 z-50">
      <div class="absolute inset-0 bg-black/40"></div>
      <div class="relative mx-auto my-8 w-[95%] max-w-3xl bg-white rounded-2xl border border-gray-200 overflow-hidden">
        <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200">
          <div class="flex items-center gap-2">
            <i data-lucide="book-open" class="w-5 h-5 text-gray-700"></i>
            <h2 class="text-lg tracking-tight font-semibold">Ghid începător — Cum folosesc pagina</h2>
          </div>
          <button data-close-guide class="p-2 rounded-lg border bg-gray-50 hover:bg-gray-100" aria-label="Închide">
            <i data-lucide="x" class="w-4 h-4"></i>
          </button>
        </div>
        <div class="p-4 text-sm space-y-3">
          <div>
            <div class="font-semibold mb-1">Pasul 1 — Alege strategia (tab sus)</div>
            <div>EQ-INV (investiții), EQ-MOM (momentum), OPT-INCOME (opțiuni). Nu amesteca tab-urile.</div>
          </div>
          <div>
            <div class="font-semibold mb-1">Pasul 2 — Daily Brief (08:00)</div>
            <div>Apasă „Daily Brief”. Vezi regimul macro + Top 3 idei/strategie + calendar. Fiecare are citări.</div>
          </div>
          <div>
            <div class="font-semibold mb-1">Pasul 3 — Pune o întrebare pe tab</div>
            <div>Ex.: „EQ-MOM: dă Top 3 set-up-uri azi, cu citări.” Primești Teză + Setup + Invalidare + Niveluri + Risc, cu [citări]. Dacă apare „Insuficient context”, încarcă surse sau ajustează K/N/τ.</div>
          </div>
          <div>
            <div class="font-semibold mb-1">Pasul 4 — Verifică sursele</div>
            <div>Apasă pe [n] sau „Deschide pasaj” ca să vezi fragmentul exact.</div>
          </div>
          <div>
            <div class="font-semibold mb-1">Pasul 5 — Jurnal</div>
            <div>Apasă „Trimite în Jurnal” → confirmi/editzi; ulterior poți exporta CSV.</div>
          </div>
          <div class="pt-2 border-t border-gray-200 text-xs text-gray-600">
            Reguli: Context-Only • No-mix pe tab • Sugestii, nu ordine • τ/K/N, Reranker, MMR vizibile.
          </div>
        </div>
        <div class="px-4 py-3 border-t border-gray-200">
          <button data-close-guide class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-900 text-white text-sm hover:bg-gray-800">
            <i data-lucide="check" class="w-4 h-4"></i> Închis
          </button>
        </div>
      </div>
    </div>

    <!-- Journal Modal -->
    <div id="journalModal" class="hidden fixed inset-0 z-50">
      <div class="absolute inset-0 bg-black/40"></div>
      <div class="relative mx-auto my-8 w-[95%] max-w-5xl bg-white rounded-2xl border border-gray-200 overflow-hidden">
        <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200">
          <div class="flex items-center gap-2">
            <i data-lucide="notebook-pen" class="w-5 h-5 text-gray-700"></i>
            <h2 class="text-lg tracking-tight font-semibold">Jurnal decizii</h2>
            <span class="text-xs text-gray-500">CSV schema fixă</span>
          </div>
          <div class="flex items-center gap-2">
            <button id="exportCSV" class="inline-flex items-center gap-2 px-3 py-2 rounded-lg border bg-gray-50 hover:bg-gray-100 text-sm">
              <i data-lucide="file-down" class="w-4 h-4"></i> Export CSV
            </button>
            <button data-close-journal class="p-2 rounded-lg border bg-gray-50 hover:bg-gray-100" aria-label="Închide">
              <i data-lucide="x" class="w-4 h-4"></i>
            </button>
          </div>
        </div>

        <div class="p-4 grid grid-cols-1 lg:grid-cols-3 gap-4">
          <!-- Add Entry -->
          <div class="lg:col-span-1 rounded-xl border border-gray-200 bg-gray-50/50 p-3">
            <div class="flex items-center justify-between mb-2">
              <h3 class="text-sm font-semibold tracking-tight">Add entry</h3>
              <span id="riskHint" class="text-xs text-amber-700 bg-amber-50 border border-amber-200 px-2 py-0.5 rounded-md hidden">Verifică riscul</span>
            </div>

            <form id="journalForm" class="space-y-2 text-sm">
              <div class="grid grid-cols-2 gap-2">
                <div>
                  <label class="block text-xs text-gray-500 mb-1">timestamp</label>
                  <input id="jf_timestamp" type="datetime-local" class="w-full rounded-lg border border-gray-200 px-2 py-2 focus:outline-none focus:ring-2 focus:ring-gray-900/10">
                </div>
                <div>
                  <label class="block text-xs text-gray-500 mb-1">strategy (A/B/C)</label>
                  <select id="jf_strategy" class="w-full rounded-lg border border-gray-200 px-2 py-2 focus:outline-none focus:ring-2 focus:ring-gray-900/10">
                    <option value="A">A — EQ-INV</option>
                    <option value="B">B — EQ-MOM/PEAD</option>
                    <option value="C">C — OPT-INCOME</option>
                  </select>
                </div>
              </div>

              <div class="grid grid-cols-2 gap-2">
                <div>
                  <label class="block text-xs text-gray-500 mb-1">symbol</label>
                  <input id="jf_symbol" type="text" placeholder="AAPL" class="w-full rounded-lg border border-gray-200 px-2 py-2 focus:outline-none focus:ring-2 focus:ring-gray-900/10">
                </div>
                <div>
                  <label class="block text-xs text-gray-500 mb-1">direction</label>
                  <select id="jf_direction" class="w-full rounded-lg border border-gray-200 px-2 py-2 focus:outline-none focus:ring-2 focus:ring-gray-900/10">
                    <option value="long">long</option>
                    <option value="short">short</option>
                  </select>
                </div>
              </div>

              <div class="grid grid-cols-3 gap-2">
                <div>
                  <label class="block text-xs text-gray-500 mb-1">entry</label>
                  <input id="jf_entry" type="number" step="0.0001" class="w-full rounded-lg border border-gray-200 px-2 py-2 focus:outline-none focus:ring-2 focus:ring-gray-900/10">
                </div>
                <div>
                  <label class="block text-xs text-gray-500 mb-1">size</label>
                  <input id="jf_size" type="number" step="0.0001" class="w-full rounded-lg border border-gray-200 px-2 py-2 focus:outline-none focus:ring-2 focus:ring-gray-900/10">
                </div>
                <div>
                  <label class="block text-xs text-gray-500 mb-1">stop</label>
                  <input id="jf_stop" type="number" step="0.0001" class="w-full rounded-lg border border-gray-200 px-2 py-2 focus:outline-none focus:ring-2 focus:ring-gray-900/10">
                </div>
              </div>

              <div class="grid grid-cols-2 gap-2">
                <div>
                  <label class="block text-xs text-gray-500 mb-1">tp</label>
                  <input id="jf_tp" type="number" step="0.0001" class="w-full rounded-lg border border-gray-200 px-2 py-2 focus:outline-none focus:ring-2 focus:ring-gray-900/10">
                </div>
                <div>
                  <label class="block text-xs text-gray-500 mb-1">tags</label>
                  <input id="jf_tags" type="text" placeholder="breakout, earnings" class="w-full rounded-lg border border-gray-200 px-2 py-2 focus:outline-none focus:ring-2 focus:ring-gray-900/10">
                </div>
              </div>

              <div>
                <label class="block text-xs text-gray-500 mb-1">rationale</label>
                <textarea id="jf_rationale" rows="4" class="w-full rounded-lg border border-gray-200 px-2 py-2 focus:outline-none focus:ring-2 focus:ring-gray-900/10" placeholder="Teză + niveluri (precompletate din răspuns)."></textarea>
              </div>

              <div id="softWarn" class="hidden text-xs text-amber-700 bg-amber-50 border border-amber-200 px-2 py-1 rounded-md">
                Avertizare: setarea stop/TP sau mărimea poate depăși profilul de risc al trade-ului.
              </div>

              <div class="pt-1 flex items-center gap-2">
                <button id="jf_submit" type="submit" class="inline-flex items-center gap-2 rounded-lg bg-gray-900 text-white px-3 py-2 text-sm hover:bg-gray-800">
                  <i data-lucide="plus" class="w-4 h-4"></i> Adaugă
                </button>
                <button id="jf_reset" type="button" class="inline-flex items-center gap-2 rounded-lg border bg-gray-50 px-3 py-2 text-sm hover:bg-gray-100">
                  <i data-lucide="eraser" class="w-4 h-4"></i> Reset
                </button>
              </div>
            </form>
          </div>

          <!-- List -->
          <div class="lg:col-span-2 rounded-xl border border-gray-200 bg-gray-50/50 p-3">
            <div class="flex items-center justify-between mb-2">
              <h3 class="text-sm font-semibold tracking-tight">Decizii recente</h3>
              <div class="text-xs text-gray-500">Status • PnL • R/R • Link răspuns</div>
            </div>
            <div id="journalList" class="space-y-2">
              <div class="animate-pulse h-16 bg-gray-100 rounded"></div>
              <div class="animate-pulse h-16 bg-gray-100 rounded"></div>
            </div>
          </div>
        </div>

        <div class="px-4 py-3 border-t border-gray-200 text-xs text-gray-500">
          Export CSV: câmpuri — timestamp,strategy,symbol,direction,entry,size,stop,tp,rationale,tags
        </div>
      </div>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="hidden fixed inset-0 z-50">
      <div class="absolute inset-0 bg-black/40"></div>
      <div class="relative mx-auto my-8 w-[95%] max-w-3xl bg-white rounded-2xl border border-gray-200 overflow-hidden">
        <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200">
          <div class="flex items-center gap-2">
            <i data-lucide="upload-cloud" class="w-5 h-5 text-gray-700"></i>
            <h2 class="text-lg tracking-tight font-semibold">Upload surse</h2>
          </div>
          <button data-close-upload class="p-2 rounded-lg border bg-gray-50 hover:bg-gray-100" aria-label="Închide">
            <i data-lucide="x" class="w-4 h-4"></i>
          </button>
        </div>

        <div class="p-4 space-y-3">
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
            <div class="sm:col-span-2">
              <label class="block text-xs text-gray-500 mb-1">Fișiere (drag & drop sau alege)</label>
              <div id="dropzone" class="flex items-center justify-center h-28 rounded-xl border-2 border-dashed border-gray-300 bg-gray-50 hover:bg-gray-100 text-gray-500">
                <div class="text-center">
                  <i data-lucide="files" class="w-5 h-5 mx-auto mb-1"></i>
                  <div class="text-xs">Trage fișiere aici sau</div>
                  <label class="inline-flex items-center gap-1 mt-1 px-2 py-1 rounded-md border bg-white text-xs cursor-pointer">
                    <i data-lucide="folder-open" class="w-3.5 h-3.5"></i>
                    <input id="fileInput" type="file" class="hidden" multiple>
                    Alege fișiere
                  </label>
                </div>
              </div>
            </div>
            <div>
              <label class="block text-xs text-gray-500 mb-1">Strategia țintă</label>
              <select id="uploadStrategy" class="w-full rounded-lg border border-gray-200 px-2 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gray-900/10">
                <option value="A">A — EQ-INV</option>
                <option value="B">B — EQ-MOM/PEAD</option>
                <option value="C">C — OPT-INCOME</option>
              </select>
              <button id="btnStartUpload" class="mt-2 w-full inline-flex items-center justify-center gap-2 rounded-lg bg-gray-900 text-white px-3 py-2 text-sm hover:bg-gray-800">
                <i data-lucide="arrow-up-right" class="w-4 h-4"></i> <span id="uploadBtnLabel">Încarcă</span>
              </button>
              <button id="btnRetryUpload" class="mt-2 w-full inline-flex items-center justify-center gap-2 rounded-lg border bg-white px-3 py-2 text-sm hover:bg-gray-50 hidden">
                <i data-lucide="rotate-cw" class="w-4 h-4"></i> Reîncearcă
              </button>
            </div>
          </div>

          <div class="pt-2 border-t border-gray-200">
            <div class="text-xs text-gray-500 mb-2">Status ingestie</div>
            <div id="uploadList" class="space-y-2">
              <div class="text-xs text-gray-400">Niciun fișier încă.</div>
            </div>
            <div class="mt-3">
              <div class="text-xs text-gray-500 mb-1">Upload logs (live)</div>
              <div id="uploadLogs" class="h-24 overflow-auto rounded-lg border bg-white p-2 text-xs text-gray-700">
                <div class="text-gray-400">În așteptare…</div>
              </div>
            </div>
          </div>
        </div>

        <div class="px-4 py-3 border-t border-gray-200 text-xs text-gray-500">
          Acceptat • Dedup • Respins (motiv)
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="hidden fixed inset-0 z-50">
      <div class="absolute inset-0 bg-black/40"></div>
      <div class="relative mx-auto my-8 w-[95%] max-w-3xl bg-white rounded-2xl border border-gray-200 overflow-hidden">
        <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200">
          <div class="flex items-center gap-2">
            <i data-lucide="settings" class="w-5 h-5 text-gray-700"></i>
            <h2 class="text-lg tracking-tight font-semibold">Setări</h2>
          </div>
          <button data-close-settings class="p-2 rounded-lg border bg-gray-50 hover:bg-gray-100" aria-label="Închide">
            <i data-lucide="x" class="w-4 h-4"></i>
          </button>
        </div>

        <div class="p-4 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
          <div class="rounded-xl border border-gray-200 bg-gray-50/50 p-3">
            <div class="text-xs text-gray-500 mb-2">Retrieval (read-only)</div>
            <div class="grid grid-cols-2 gap-2">
              <div class="flex items-center justify-between rounded-lg border bg-white px-2 py-1.5"><span>K</span><span id="s_K" class="text-gray-600">—</span></div>
              <div class="flex items-center justify-between rounded-lg border bg-white px-2 py-1.5"><span>N</span><span id="s_N" class="text-gray-600">—</span></div>
              <div class="flex items-center justify-between rounded-lg border bg-white px-2 py-1.5"><span>τ</span><span id="s_tau" class="text-gray-600">—</span></div>
              <div class="flex items-center justify-between rounded-lg border bg-white px-2 py-1.5"><span>Reranker</span><span id="s_reranker" class="text-gray-600">—</span></div>
              <div class="flex items-center justify-between rounded-lg border bg-white px-2 py-1.5"><span>MMR</span><span id="s_mmr" class="text-gray-600">—</span></div>
              <div class="flex items-center justify-between rounded-lg border bg-white px-2 py-1.5"><span>Recency</span><span id="s_recency" class="text-gray-600">—</span></div>
            </div>
          </div>

          <div class="rounded-xl border border-gray-200 bg-gray-50/50 p-3">
            <div class="text-xs text-gray-500 mb-2">Policy</div>
            <div class="flex items-center justify-between rounded-lg border bg-white px-3 py-2">
              <div class="text-sm">Context-Only</div>
              <div class="relative">
                <label class="inline-flex items-center">
                  <input type="checkbox" checked disabled class="peer sr-only">
                  <span class="w-10 h-6 rounded-full bg-gray-900/80 peer-checked:bg-gray-900 relative">
                    <span class="absolute top-0.5 left-0.5 w-5 h-5 rounded-full bg-white transition-all peer-checked:translate-x-4"></span>
                  </span>
                </label>
              </div>
            </div>
            <div class="mt-2 text-xs text-gray-500">Fixat ON în V1 (nu poate fi modificat).</div>
          </div>

          <div class="sm:col-span-2 rounded-xl border border-gray-200 bg-gray-50/50 p-3">
            <div class="text-xs text-gray-500 mb-2">Portofoliu CSV — format câmpuri (conform Jurnal)</div>
            <div class="rounded-lg border bg-white px-3 py-2 text-xs text-gray-700 overflow-x-auto">timestamp,strategy,symbol,direction,entry,size,stop,tp,rationale,tags</div>
          </div>
        </div>

        <div class="px-4 py-3 border-t border-gray-200 text-xs text-gray-500">
          Valorile sunt informative; UI nu modifică parametrii de retrieval.
        </div>
      </div>
    </div>

    <!-- Icons + App scripts -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="assets/js/state.js"></script>
    <script src="assets/js/mockData.js"></script>
    <script src="assets/js/apiClient.js"></script>
    <script src="assets/js/app.js"></script>
  </body>
  </html>


